<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Disaster Monitoring Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #333;
    }
    .sensor {
      font-size: 20px;
      margin: 10px 0;
    }
    .alert {
      font-weight: bold;
      color: red;
      margin-top: 20px;
      font-size: 22px;
    }
    .ok {
      color: green;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>Disaster Monitoring Dashboard</h1>
  <div class="sensor" id="temperature"></div>
  <div class="sensor" id="smoke"></div>
  <div class="sensor" id="vibration"></div>
  <div class="sensor" id="waterLevel"></div>
  <div class="sensor" id="rain"></div>
  <div class="alert" id="alertMsg"></div>

  <script>
    const channelID = "2918732";
    const readAPIKey = "4W8JWYPU324TRM3N"; // Not needed for public channels

    function fetchData() {
      fetch(`https://api.thingspeak.com/channels/2918732/feeds/last.json?api_key=${readAPIKey}`)

        .then(response => response.json())
        .then(data => {
          const temperature = parseFloat(data.field1);
          const smoke = parseFloat(data.field2);
          const vibration = parseFloat(data.field3);
          const waterLevel = parseFloat(data.field4);
          const rain = parseFloat(data.field5);

          document.getElementById("temperature").innerHTML = `üå°Ô∏è Temperature: ${temperature} ¬∞C`;
          document.getElementById("smoke").innerHTML = `üí® Smoke: ${smoke}`;
          document.getElementById("vibration").innerHTML = `üåç Vibration: ${vibration}`;
          document.getElementById("waterLevel").innerHTML = `üíß Water Level: ${waterLevel}`;
          document.getElementById("rain").innerHTML = `üåßÔ∏è Rain Level: ${rain}`;

          // Alerts
          let alertMessage = "";

          if (temperature > 45 && smoke > 500) {
            alertMessage += "üî• Forest Fire Alert!<br>";
          }

          if (vibration > 100) {
            alertMessage += "üåç Earthquake Alert!<br>";
          }

          if (waterLevel > 800 || rain > 600) {
            alertMessage += "üåä Flood Alert!<br>";
          }

          document.getElementById("alertMsg").innerHTML = alertMessage || "<span class='ok'>‚úÖ All conditions normal.</span>";
        })
        .catch(err => {
          console.error("Error fetching data:", err);
          document.getElementById("alertMsg").innerHTML = "‚ö†Ô∏è Error fetching data!";
        });
    }

    // Fetch data every 20 seconds
    fetchData();
    setInterval(fetchData, 20000);
  </script>
</body>
</html>
