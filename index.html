<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IoT Disaster Monitoring Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .sensor {
      background: #fff;
      padding: 15px;
      margin: 15px auto;
      border-radius: 10px;
      max-width: 500px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .alert {
      color: red;
      font-weight: bold;
    }
    .label {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Disaster Monitoring Dashboard</h1>

  <div class="sensor">
    <div><span class="label">Temperature:</span> <span id="temperature">--</span></div>
    <div><span class="label">Smoke:</span> <span id="smoke">--</span></div>
    <div><span class="label">Vibration:</span> <span id="vibration">--</span></div>
    <div><span class="label">Water Level:</span> <span id="waterLevel">--</span></div>
    <div><span class="label">Rain:</span> <span id="rain">--</span></div>
    <div id="alert" class="alert"></div>
  </div>

  <script>
    const channelID = "2918732";
    const apiKey = "4W8JWYPU324TRM3N"; // Your actual Read API Key

    const fieldMapping = {
      temperature: 'field1',
      smoke: 'field2',
      vibration: 'field3',
      waterLevel: 'field4',
      rain: 'field5'
    };

    async function fetchData() {
      try {
        const response = await fetch(`https://api.thingspeak.com/channels/${channelID}/feeds/last.json?api_key=${apiKey}`);
        const data = await response.json();

        const sensorReadings = {};
        for (const [key, field] of Object.entries(fieldMapping)) {
          const reading = parseFloat(data[field]);
          sensorReadings[key] = isNaN(reading) ? 0 : reading;
          document.getElementById(key).innerText = sensorReadings[key];
        }

        showAlert(sensorReadings);

      } catch (error) {
        document.getElementById("alert").innerText = "Error fetching data!";
        console.error("Fetch error:", error);
      }
    }

    function showAlert(readings) {
      const { temperature, smoke, vibration, waterLevel, rain } = readings;
      let alertMessage = "";

      if (temperature > 500 && smoke > 300) {
        alertMessage += "🔥 Forest Fire Alert! ";
      }
      if (vibration > 500) {
        alertMessage += "🌍 Earthquake Alert! ";
      }
      if (waterLevel > 600 || rain > 400) {
        alertMessage += "🌊 Flood Alert! ";
      }

      document.getElementById("alert").innerText = alertMessage || "✅ All sensors normal.";
    }

    fetchData();
    setInterval(fetchData, 20000);
  </script>
</body>
</html>
